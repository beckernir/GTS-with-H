<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>{{ report_type }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }

        h1 {
            color: #2c3e50;
        }

        .desc {
            color: #555;
            margin-bottom: 20px;
        }

        .footer {
            margin-top: 40px;
            font-size: 0.9em;
            color: #888;
        }
    </style>
</head>

<body>
    <h1>Monthly Report</h1>
    <div class="desc">Monthly summary of key metrics, budgets, and KPIs.</div>
    <hr>
    <h2>Prepared For:</h2>
    <p>{{ user.get_full_name|default:user.username }}</p>
    <h3>Budget Reports</h3>
    {% if budget_reports %}
    <table border="1" cellpadding="5" cellspacing="0">
        <tr>
            <th>Title</th>
            <th>Period</th>
            <th>Amount</th>
        </tr>
        {% for b in budget_reports %}
        <tr>
            <td>{{ b.report_title }}</td>
            <td>{{ b.report_period_start|date:"Y-m-d" }} to {{ b.report_period_end|date:"Y-m-d" }}</td>
            <td>{{ b.report_data.amount|default:"-" }}</td>
        </tr>
        {% endfor %}
    </table>
    {% else %}<p>No budget reports found.</p>{% endif %}
    <h3>KPIs</h3>
    {% if kpis %}
    <ul>
        {% for kpi in kpis %}
        <li>{{ kpi.kpi_name }} ({{ kpi.get_kpi_category_display }}) - Target: {{ kpi.target_value }}</li>
        {% endfor %}
    </ul>
    {% else %}<p>No KPIs found.</p>{% endif %}
    <h3>KPI Values</h3>
    {% if kpi_values %}
    <table border="1" cellpadding="5" cellspacing="0">
        <tr>
            <th>KPI</th>
            <th>Value</th>
            <th>Date</th>
            <th>Status</th>
        </tr>
        {% for v in kpi_values %}
        <tr>
            <td>{{ v.kpi.kpi_name }}</td>
            <td>{{ v.value }}</td>
            <td>{{ v.measurement_date|date:"Y-m-d" }}</td>
            <td>{{ v.performance_status }}</td>
        </tr>
        {% endfor %}
    </table>
    {% else %}<p>No KPI values found.</p>{% endif %}
    <div class="footer">
        Generated by GrantTracker Reporting System<br>
        Date: {{ now|date:"Y-m-d H:i" }}
    </div>
</body>

</html>